ecotech <- go_dutch
ecotech$Scenario <- "Ecotechnic"
s2050 <- rbind(dft, slow_start, go_dutch, ecotech)
library(ggplot2)
ggplot() + geom_vline(xintercept = c(2025, 2050), linetype = 3) + geom_hline(yintercept = c(10, 25), linetype = 2) + geom_line(data = s2050, aes(x = Year, y = Perc_stages, color = Scenario, linetype = Scenario)) + ylab("Percentage of trips by bicycle") +  theme_bw() + scale_color_brewer(type = "qual", palette = 6, name = "Model") + scale_shape_discrete(name = "Data", solid = F) + geom_text(aes(2020, py, label = ptext), size = 4) +
scale_linetype_manual(values = c(1,1,1,2), guide = "none")
# write.csv(s2050, "scenarios.csv")
# ggsave("figures/stages.png")
# tsam <- ntstrips[sample(nrow(ntstrips), size = 500), ] # sample dataset to play with
tsam <- ntstrips # the full dataset
head(tsam)
tsam$mode <- as.character(tsam$mode)
tsam$mode[grep("Other|Tax|Moto|LT|Rail", tsam$mode)] <- "Other"
tsam$mode[grep("bus", tsam$mode)] <- "Bus"
tsam$mode <- factor(tsam$mode)
summary(tsam$mode) # great - this is the data in the form it needs to be in...
tsam$purp <- as.character(tsam$purp)
tsam$purp[grep("Visit", tsam$purp)] <- "Visiting.friends"
library(knitr)
All_modes <- table(tsam$purp)
# Checking it works
library(ggplot2)
ggplot(tsam[ tsam$dist < 300, ]) + geom_histogram(aes(x = dist/10, fill = mode)) + scale_fill_brewer(type = "qual") + xlab("Miles")
library(birk) # package for distance conversion
tsam$dkm <- conv_unit(tsam$dist / 10, mi, km)
# Generate new mode column
iac <- function(x, a, b){
a * exp(1)^(-b * x)
}
# plot(iac(1:10, 0.4, 0.3)) # test it makes sense
pswitch <- iac(tsam$dkm, a = 0.3, b = 0.2)
pswitch[ tsam$mode == "Bicycle"] <- 0 # probability of switch for cyclists = 0
# plot(pswitch, tsam$dkm)
set.seed(100)
size = length(which(tsam$mode == "Bicycle")) # the number of people who will switch mode
size
# Change in the cycling rate
# Rate of cycling in future - DfT scenario - baseline
size2025dft <- nrow(tsam) * s2050$Perc_stages[s2050$Scenario == "DfT" & s2050$Year == 2025] / 100 -
nrow(tsam) * 0.017 #
# The go Dutch scenario
size2025godutch =  nrow(tsam) * s2050$Perc_stages[s2050$Scenario == "Go Dutch" & s2050$Year == 2025] / 100 -
nrow(tsam) * 0.017
sel <- sample(nrow(tsam), size = size2025dft, prob = pswitch)
tsam$dswitch_2025_dft <- tsam$mode
tsam$dswitch_2025_dft[sel] <- "Bicycle"
sel <- sample(nrow(tsam), size = size2025godutch, prob = pswitch)
tsam$dswitch_2025_go <- tsam$mode
tsam$dswitch_2025_go[sel] <- "Bicycle"
# Savings / changes
# Baseline distance cycled
tsam$dcycle <- 0
tsam$dcycle[ tsam$mode == "Bicycle"] <- tsam$dkm[tsam$mode == "Bicycle"]
# Health benefits from increased cycling
tsam$dcycle_2025_dft <- tsam$dist * 0
tsam$dcycle_2025_dft[ tsam$dswitch_2025_dft == "Bicycle"] <- tsam$dkm[tsam$dswitch_2025_dft == "Bicycle"]
tsam$dcycle_2025_go <- tsam$dist * 0
tsam$dcycle_2025_go[ tsam$dswitch_2025_go == "Bicycle"] <- tsam$dkm[ tsam$dswitch_2025_go == "Bicycle"]
summary(tsam[c("dcycle_2025_go", "dcycle_2025_dft", "dcycle")])
names(tsam)
# Increase from current
# tsam$dcycleNew[sel] <- tsam$dkm[sel]
# tsam$dcycleNew[tsam$mode == "Walk"] <- 0
# Increase from future baseline
# future_shift
# Estimates of energy savings
tsam$epkm <- 0
tsam$epkm[ grep("driv", tsam$mode)  ] <- 3
tsam$epkm[ grep("Bus", tsam$mode)  ] <- 2
tsam$esave <- tsam$epkm * tsam$dkm
# Next stage: take tsam as input into msim to estimate savings per x
individuals <- group_by(tsam, psuid, i1, house )
individuals <- group_by(tsam, psuid, i1, house )
class(tsam$dist)
library(devtools)
session_info()
install_github("hadley/dplyr")
session_info()
library(dplyr)
session_info()
individuals <- group_by(tsam, psuid, i1, house )
sessionInfo()
library("dplyr")
sessionInfo()
individuals <- group_by(tsam, psuid, i1, house )
indscen <- summarise(group_by(tsam, psuid, i1, house ), dist_cycle = sum(dcycle), dist_cycle_dft = sum(dcycle_2025_dft), dist_cycle_go = sum(dcycle_2025_go)) # the saving per person
tsam$dist <- as.numeric(tsam$dist)
individuals <- group_by(tsam, psuid, i1, house )
tsam <- tsam[1:nrow(tsam),]
individuals <- group_by(tsam, psuid, i1, house )
indscen <- summarise(individuals, dist_cycle = sum(dcycle), dist_cycle_dft = sum(dcycle_2025_dft), dist_cycle_go = sum(dcycle_2025_go)) # the saving per person
individuals
summarise(individuals, never_cycled = n(dcycle == 0)) # the saving per person
length(which(indscen$dist_cycle_go == 0))
length(which(indscen$dist_cycle_go == 0)) / nrow(indscen)
cut(x = c(1, 1.999, 2, 3), breaks = c(1,2,3))
cut(x = c(1, 1.999, 2, 3), breaks = c(0,2,3))
individuals <- group_by(tsam, psuid, i1, house )
indscen <- summarise(individuals, dist_cycle = sum(dcycle), dist_cycle_dft = sum(dcycle_2025_dft), dist_cycle_go = sum(dcycle_2025_go)) # the saving per person
summary(indscen)
summary(indscen$dist_cycle)
summary(indscen$dist_cycle_go)
summary(indscen$dist_cycle[ indscen$dist_cycle > 0])
indscen_all <- inner_join(ind, indscen) # join other attributes to individ. data
indscen_subset <- indscen_all[4000:5000,]
length(which(indscen_subset$dist_cycle_go == 0)) / nrow(indscen) # the overall percentage
length(which(indscen_subset$dist_cycle_go == 0)) / nrow(indscen_subset) # the overall percentage
indscen_subset$age
indscen_subset$i2
levels(indscen_subset$agecat)
levels(indscen_subset$age)
agecats <- data_frame(age = levels(indscen_subset$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists, sd_dis_cyclists = NA)
agecats <- data.frame(age = levels(indscen_subset$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists, sd_dis_cyclists = NA)
agecats <- data_frame(age = levels(indscen_subset$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA)
agecats
iss <- indscen_all[4000:5000,]
length(which(iss$dist_cycle_go == 0)) / nrow(iss) # the overall percentage
agecats
for(i in levels(iss$age)){
sel <- iss$age == i
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0)
}
agecats
for(i in levels(iss$age)){
sel <- iss$age == i
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0) / nrow(iss)
}
names(indscen)
mean(iss$dist_cycle[sel] == 0)
mean(iss$dist_cycle[sel])
iss$dist_cycle[sel]
i
i = levels(iss$age)[3]
iss$dist_cycle[sel]
sel <- iss$age == i
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0) / nrow(iss)
agecats$mean_dis[agecats$age == i] <- mean(iss$dist_cycle[sel])
mean(iss$dist_cycle[sel])
mean(iss$dist_cycle[sel]) / agecats$not_cycled[agecats$age == i]
agecats$not_cycled[agecats$age == i]
for(i in levels(iss$age)){
sel <- which(iss$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss$dist_cycle[sel])
agecats$mean_dis_cyclists[agecats$age == i] <-
mean(iss$dist_cycle[sel]) / agecats$not_cycled[agecats$age == i]
}
agecats
length(sel)
i <- levels(iss$age)[2]
agecats$not_cycled[agecats$age == i]
sum(iss$dist_cycle[sel] == 0)
length(sel)
sel <- which(iss$age == i)
sel
iss[sel,]
sum(iss$dist_cycle[sel] == 0)
iss$dist_cycle[sel]
length(sel)
sum(iss$dist_cycle[sel] == 0) / length(sel)
sum(iss$dist_cycle[sel] == 0)
agecats
iss$dist_cycle
head(iss)
agecats
agecats$not_cycled[agecats$age == i]
mean(iss$dist_cycle[sel]) / (1 - agecats$not_cycled[agecats$age == i] )
sel[iss$dist_cycle[sel] > 0
]
mean(iss$dist_cycle[sel2])
sel2 <- sel[iss$dist_cycle[sel] > 0] # cyclists
mean(iss$dist_cycle[sel2])
agecats$mean_dis_cyclists[agecats$age == i] <-
mean(iss$dist_cycle[sel]) / (1 - agecats$not_cycled[agecats$age == i] )
mean(iss$dist_cycle[sel]) / (1 - agecats$not_cycled[agecats$age == i] )
agecats <- data_frame(age = levels(iss$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA, not_cycled_dft = NA, mean_dis_dft = NA, mean_dis_cyclists_dft = NA, sd_dis_cyclists_dft = NA, )
for(i in levels(iss$age)){
}
agecats
agecats <- data_frame(age = levels(iss$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA, not_cycled_dft = NA, mean_dis_dft = NA, mean_dis_cyclists_dft = NA, sd_dis_cyclists_dft = NA, )
agecats <- data_frame(age = levels(iss$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA, not_cycled_dft = NA, mean_dis_dft = NA, mean_dis_cyclists_dft = NA, sd_dis_cyclists_dft = NA)
for(i in levels(iss$age)){
sel <- which(iss$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss$dist_cycle[sel])
sel2 <- sel[iss$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss$dist_cycle_dft[sel])
sel2 <- sel[ iss$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss$dist_cycle_dft[sel2])
}
agecat
agecats
sd(iss$dist_cycle_dft[sel2])
write.csv(agecats, file = "/tmp/age_cats.csv")
a <- iss[1:30,]
a[a = "0 - 4 years"]
a <- iss$age[1:30]
a[a = "0 - 4 years"]
a
a <- iss$age[40:60]
a
a[a = "0 - 4 years" | a = "5 - 10 years" | a = "10 - 15 years"]
a[a == "0 - 4 years" | a == "5 - 10 years" | a == "10 - 15 years"]
a[a == "0 - 4 years" | a == "5 - 10 years" | a == "10 - 15 years" | a == "16 - 19 years"]
a <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
b <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "10 - 15 years"] <- "0-14"
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "10 - 15 years"] <- "0-14"
a2
a[a == "0 - 4 years" | a == "5 - 10 years" | a == "10 - 15 years"]
a <- iss$age[40:60]
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "10 - 15 years"] <- "0-14"
a2
levels(a)
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a <- iss$age[40:60]
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2
a
levels(a)
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = length(over70) / 0.397)
over80 <- sample(over70, size = (length(over70) / 0.397))
over70
which(a == "70 + years")
length(over70) / 0.397
length(over70)
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
levels(a2)
levels(a)
f40_t49 <- which(a == "40 - 49 years")
f40_t49
sample(f40_t49, size = length(f40_t49) / 2)
o30_39 <- sample(f40_t49, size = length(f40_t49) / 2)
f40_t49 %in% o30_39
o45_59 <- f40_t49[!f40_t49 %in% o30_39]
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
levels(a2)
a <- iss$age[40:60]
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2[a == "30 - 39 years" ] <- "30-44"
f40_t49 <- which(a == "40 - 49 years") # we need to split this variable in two
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
o45_59 <- f40_t49[!f40_t49 %in% o30_44]
a2[o30_44] <- "30-44"
a2[o45_59] <- "45-59"
a2[a == "60 - 69 years" ] <- "60-69"
a2[a == "70 + years" ] <- "70-79" # all people over 70...
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
f50_t59 <- which(a == "50 - 59 years")
f50_t59 <- which(a == "50 - 59 years")
a <- iss$age[40:60]
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2[a == "30 - 39 years" ] <- "30-44"
f40_t49 <- which(a == "40 - 49 years") # we need to split this variable in two
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
o45_59 <- f40_t49[!f40_t49 %in% o30_44]
a2[o30_44] <- "30-44"
a2[o45_59] <- "45-59"
a2[a == "50 - 59 years" ] <- "45-59"
a2[a == "60 - 69 years" ] <- "60-69"
a2[a == "70 + years" ] <- "70-79" # all people over 70...
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
a2[a == "50 - 59 years" ] <- "50-54"
cbdin(a,a2)
cbdind(a,a2)
cbind(a,a2)
a <- iss$age[40:60]
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2[a == "30 - 39 years" ] <- "30-44"
f40_t49 <- which(a == "40 - 49 years") # we need to split this variable in two
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
o45_59 <- f40_t49[!f40_t49 %in% o30_44]
a2[o30_44] <- "30-44"
a2[o45_59] <- "45-59"
a2[a == "50 - 59 years" ] <- "45-59"
a2[a == "60 - 69 years" ] <- "60-69"
a2[a == "70 + years" ] <- "70-79" # all people over 70...
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
cbind(a,a2)
# Recategorise to fit model
a <- iss$age[40:60]
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2[a == "30 - 39 years" ] <- "30-44"
f40_t49 <- which(a == "40 - 49 years") # we need to split this variable in two
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
o45_59 <- f40_t49[!f40_t49 %in% o30_44]
a2[o30_44] <- "30-44"
a2[o45_59] <- "45-59"
a2[a == "50 - 59 years" ] <- "45-59"
a2[a == "60 - 69 years" ] <- "60-69"
a2[a == "70 + years" ] <- "70-79" # all people over 70...
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
cbind(a,a2)
age_recat <- function(a){
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2[a == "30 - 39 years" ] <- "30-44"
f40_t49 <- which(a == "40 - 49 years") # we need to split this variable in two
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
o45_59 <- f40_t49[!f40_t49 %in% o30_44]
a2[o30_44] <- "30-44"
a2[o45_59] <- "45-59"
a2[a == "50 - 59 years" ] <- "45-59"
a2[a == "60 - 69 years" ] <- "60-69"
a2[a == "70 + years" ] <- "70-79" # all people over 70...
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
}
a
age_recat(a)
# Recategorise to fit model
age_recat <- function(a){
a2 <- factor(rep(NA, length(a)), levels = c("0-14", "15-29", "30-44", "45-59", "60-69", "70-79", "80+"))
a2[a == "0 - 4 years" | a == "5 - 10 years" | a == "11 - 15 years"] <- "0-14"
a2[a == "16 - 19 years" | a == "20 - 29 years"] <- "15-29"
a2[a == "30 - 39 years" ] <- "30-44"
f40_t49 <- which(a == "40 - 49 years") # we need to split this variable in two
o30_44 <- sample(f40_t49, size = length(f40_t49) / 2)
o45_59 <- f40_t49[!f40_t49 %in% o30_44]
a2[o30_44] <- "30-44"
a2[o45_59] <- "45-59"
a2[a == "50 - 59 years" ] <- "45-59"
a2[a == "60 - 69 years" ] <- "60-69"
a2[a == "70 + years" ] <- "70-79" # all people over 70...
over70 <- which(a == "70 + years")
over80 <- sample(over70, size = (length(over70) * 0.397))
a2[over80] <- "80+" # all people over 70...
a2
}
a
age_recat(a)
as.character(a)
cbind(as.character(a),as.character(a2))
a2 <- age_recat(a)
cbind(as.character(a),as.character(a2))
names(agecats)
agecats <- data_frame(age = levels(iss$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA, not_cycled_dft = NA, mean_dis_dft = NA, mean_dis_cyclists_dft = NA, sd_dis_cyclists_dft = NA, not_cycled_go_dutch = NA, mean_dis_go_dutch = NA, mean_dis_cyclists_go_dutch = NA, sd_dis_cyclists_go_dutch = NA)
names(agecats)
names(agecats)[-1]
mnames <- paste0(names(agecats)[-1], "_m")
mnames
fnames <- paste0(names(agecats)[-1], "_f")
head(iss$sex)
names(agecats)[-1] <- mnames
agecats_m <- agecats
names(agecats_m)[-1] <- mnames
mnames <- paste0(names(agecats)[-1], "_m")
fnames <- paste0(names(agecats)[-1], "_f")
# Subset the population
iss_m <- iss[ iss$sex == "Male", ]
iss_f <- iss[ iss$sex == "Female", ]
for(i in levels(iss_m$age)){
sel <- which(iss_m$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss_m$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss_m$dist_cycle[sel])
sel2 <- sel[iss_m$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss_m$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss_m$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss_m$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss_m$dist_cycle_dft[sel])
sel2 <- sel[ iss_m$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss_m$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss_m$dist_cycle_dft[sel2])
}
agecats_m <- agecats
names(agecats_m)[-1] <- mnames
# Now for females
for(i in levels(iss_f$age)){
sel <- which(iss_f$age == i)
names(agecats_m)[-1]
{}{}
agecats <- data_frame(age = levels(iss$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA, not_cycled_dft = NA, mean_dis_dft = NA, mean_dis_cyclists_dft = NA, sd_dis_cyclists_dft = NA, not_cycled_go_dutch = NA, mean_dis_go_dutch = NA, mean_dis_cyclists_go_dutch = NA, sd_dis_cyclists_go_dutch = NA)
# run the calculations
for(i in levels(iss$age)){
sel <- which(iss$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss$dist_cycle[sel])
sel2 <- sel[iss$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss$dist_cycle_dft[sel])
sel2 <- sel[ iss$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss$dist_cycle_dft[sel2])
}
# Add gender, first with names
mnames <- paste0(names(agecats)[-1], "_m")
fnames <- paste0(names(agecats)[-1], "_f")
# Subset the population
iss_m <- iss[ iss$sex == "Male", ]
iss_f <- iss[ iss$sex == "Female", ]
for(i in levels(iss_m$age)){
sel <- which(iss_m$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss_m$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss_m$dist_cycle[sel])
sel2 <- sel[iss_m$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss_m$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss_m$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss_m$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss_m$dist_cycle_dft[sel])
sel2 <- sel[ iss_m$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss_m$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss_m$dist_cycle_dft[sel2])
}
agecats_m <- agecats
agecats_m <- agecats
names(agecats_m)[-1] <- mnames
# Now for females
for(i in levels(iss_f$age)){
sel <- which(iss_f$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss_f$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss_f$dist_cycle[sel])
sel2 <- sel[iss_f$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss_f$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss_f$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss_f$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss_f$dist_cycle_dft[sel])
sel2 <- sel[ iss_f$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss_f$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss_f$dist_cycle_dft[sel2])
}
agecats_f <- agecats
names(agecats_m)[-1] <- fnames
agecats <- cbind(agecats_m, agecats_f[-1])
View(agecats)
agecats <- data_frame(age = levels(iss$age), not_cycled = NA, mean_dis = NA, mean_dis_cyclists = NA, sd_dis_cyclists = NA, not_cycled_dft = NA, mean_dis_dft = NA, mean_dis_cyclists_dft = NA, sd_dis_cyclists_dft = NA, not_cycled_go_dutch = NA, mean_dis_go_dutch = NA, mean_dis_cyclists_go_dutch = NA, sd_dis_cyclists_go_dutch = NA)
names(agecats)
for(i in levels(iss$age)){
sel <- which(iss$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss$dist_cycle[sel])
sel2 <- sel[iss$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss$dist_cycle_dft[sel])
sel2 <- sel[ iss$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss$dist_cycle_dft[sel2])
}
# Add gender, first with names
mnames <- paste0(names(agecats)[-1], "_m")
fnames <- paste0(names(agecats)[-1], "_f")
# Subset the population
iss_m <- iss[ iss$sex == "Male", ]
iss_f <- iss[ iss$sex == "Female", ]
for(i in levels(iss_m$age)){
sel <- which(iss_m$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss_m$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss_m$dist_cycle[sel])
sel2 <- sel[iss_m$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss_m$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss_m$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss_m$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss_m$dist_cycle_dft[sel])
sel2 <- sel[ iss_m$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss_m$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss_m$dist_cycle_dft[sel2])
}
agecats_m <- agecats
names(agecats_m)[-1]
mnames
names(agecats_m)[-1] <- mnames
# Now for females
for(i in levels(iss_f$age)){
sel <- which(iss_f$age == i)
agecats$not_cycled[agecats$age == i] <- sum(iss_f$dist_cycle[sel] == 0) / length(sel)
agecats$mean_dis[agecats$age == i] <- mean(iss_f$dist_cycle[sel])
sel2 <- sel[iss_f$dist_cycle[sel] > 0] # cyclists
agecats$mean_dis_cyclists[agecats$age == i] <- mean(iss_f$dist_cycle[sel2])
agecats$sd_dis_cyclists[agecats$age == i] <- sd(iss_f$dist_cycle[sel2])
agecats$not_cycled_dft[agecats$age == i] <- sum(iss_f$dist_cycle_dft[sel] == 0) / length(sel)
agecats$mean_dis_dft[agecats$age == i] <- mean(iss_f$dist_cycle_dft[sel])
sel2 <- sel[ iss_f$dist_cycle_dft [sel] > 0] # cyclists
agecats$mean_dis_cyclists_dft[agecats$age == i] <- mean(iss_f$dist_cycle_dft[sel2])
agecats$sd_dis_cyclists_dft[agecats$age == i] <- sd(iss_f$dist_cycle_dft[sel2])
}
agecats_f <- agecats
names(agecats_f)[-1] <- fnames
agecats <- cbind(agecats_m, agecats_f[-1])
View(agecats)
write.csv(agecats, file = "/tmp/age_cats.csv")
